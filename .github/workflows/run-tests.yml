name: Run Selenium Tests

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  schedule:
    - cron: '0 0 * * *'  # –ï–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ –ø–æ–ª–Ω–æ—á—å

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    # 1. –ö–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π (–û–ë–ù–û–í–õ–ï–ù–û –¥–æ v4)
    - name: Checkout repository
      uses: actions/checkout@v4
    
    # 2. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Python
    - name: Set up Python 3.10
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    # 3. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Chrome –∏ ChromeDriver (–£–ü–†–û–©–ï–ù–û - –∏—Å–ø–æ–ª—å–∑—É–µ–º –≥–æ—Ç–æ–≤—ã–π Chrome)
    - name: Install Chrome
      run: |
        sudo apt-get update
        # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Chrome –∏–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ (—É–∂–µ –µ—Å—Ç—å –≤ –æ–±—Ä–∞–∑–µ)
        sudo apt-get install -y google-chrome-stable
        google-chrome --version
    
    # 4. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python
    - name: Install Python dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è Chrome
        pip install webdriver-manager
    
    # 5. –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç—ã
    - name: Run tests with pytest
      run: |
        # –ë–∞–∑–æ–≤—ã–π –∑–∞–ø—É—Å–∫
        pytest test_lab3.py -v
        
        # –° –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π HTML –æ—Ç—á–µ—Ç–∞
        pytest test_lab3.py -v --html=test-report.html --self-contained-html
    
    # 6. –ó–∞–≥—Ä—É–∂–∞–µ–º –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã (–æ—Ç—á–µ—Ç—ã) (–û–ë–ù–û–í–õ–ï–ù–û –¥–æ v4)
    - name: Upload test reports
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: test-reports
        path: |
          test-report.html
          *.log
          screenshot*.png
        retention-days: 7
    
    # 7. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –Ω–µ—É–¥–∞—á–Ω—ã—Ö —Ç–µ—Å—Ç–∞—Ö
    - name: Notify on failure
      if: failure()
      run: |
        echo "üö® Tests failed! Check the workflow run for details."